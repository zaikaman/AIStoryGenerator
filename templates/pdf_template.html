<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ story.title }}</title>
    <style>
        @page {
            size: a4 portrait;
            margin: 0;
        }

        body {
            font-family: "MyTestFont", "DejaVu Sans", serif;
            margin: 0;
            color: #333;
        }
        .page {
            page-break-after: always;
            position: relative;
            width: 210mm;
            height: 297mm;
            overflow: hidden;
        }
        .background-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
        }
        .text-overlay {
            position: absolute;
            bottom: 10%;
            left: 10%;
            right: 10%;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            padding: 20px;
            text-align: center;
            font-size: 16pt;
            border-radius: 15px;
        }
        
        /* Cover Page */
        /* The .cover-page class is a marker and inherits all styles from .page */
        .cover-banner {
            position: absolute;
            top: 40%;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 0;
            border-top: 3px solid white;
            border-bottom: 3px solid white;
        }
        .cover-title {
            /* Inherits font from body for debugging */
            margin: 0;
            text-align: center;
            color: white;
            font-size: 52pt;
            text-shadow: 3px 3px 5px rgba(0,0,0,0.7);
        }
    </style>
</head>
<body>

    <!-- Cover Page -->
    <div class="page cover-page">
        {% if story.images and story.images[0].url %}
            <img src="{{ story.images[0].url }}" class="background-image">
        {% endif %}
        <div class="cover-banner">
            <h1 class="cover-title">{{ story.title }}</h1>
        </div>
    </div>

    <!-- Story Pages -->
    {% for i in range(story.paragraphs|length) %}
        <div class="page">
            {% if i < story.images|length and story.images[i].url %}
                <img src="{{ story.images[i].url }}" class="background-image">
            {% endif %}
            <div class="text-overlay">
                <p>{{ story.paragraphs[i] }}</p>
                {% if loop.last and story.moral %}
                    <hr>
                    <p style="font-size: 12pt; font-weight: bold;">Moral of the story:</p>
                    <p style="font-size: 10pt; font-style: italic;">{{ story.moral }}</p>
                {% endif %}
            </div>
        </div>
    {% endfor %}

</body>
</html>